■■　　授業資料URL
https://drive.google.com/drive/folders/0Bwts5UTHjM9EUS14V0w0OEMyUzQ?hl=ja

第11回：データ処理3

■課題の回答案

●プログラム例　（今日の授業のために、全部コピー・アンド・ペーストしてください）

★今週もペーストしたプログラムは消さずに、追加していってください。

#-----------------ここからペーストします----------------

movies= ["グレイテストショーマン", "風の谷のナウシカ", "君の名は", "ノーゲイム・ノーライフ", "風立ちぬ", "ジョーズ", "紅の豚", "サマーウォーズ", "時をかける少女", "シンゴジラ", "ゼログラビティ", "アナと雪の女王", "ナルニア国物語", "タイタニック", "ベイマックス", "シェイプオブウォーター", "ミニオンズ", "美女と野獣", "少林サッカー", "探偵はbarにいる", "聲の形", "言の葉の庭", "マレフィセント", "アナコンダ", "ピンポン", "キングスマン", "羊たちの沈黙", "時計じかけのオレンジ", "シャイニング", "図書館戦争", "英国王のスピーチ", "プレデターズ", "猿の惑星", "寄生獣", "レッドクリフ", "アメリカン・スナイパー", "天使にラブソングを", "アルマゲドン", "フォレストガンプ", "インターステラー", "フルメタル・ジャケット", "ジョニーは戦場へ行った", "戦慄の楽譜", "アオハライド", "ララランド", "シックスセンス", "バタフライ・エフェクト", "はじまりのうた", "パシフィックリム", "セブン", "アントマン", "本能寺ホテル", "アイ、ロボット", "土竜の唄", "海猿", "デスノート", "インセプション"]

data=
"風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,シンゴジラ,ゼログラビティ,タイタニック,ベイマックス
インターステラー,ジョニーは戦場へ行った,戦慄の楽譜,アオハライド,ララランド,シックスセンス,バタフライ・エフェクト,アントマン,本能寺ホテル,アイ、ロボット,土竜の唄,海猿,デスノート,インセプション
時をかける少女,タイタニック,図書館戦争,アオハライド,海猿,デスノート
サマーウォーズ,ベイマックス,少林サッカー,探偵はbarにいる,寄生獣,レッドクリフ,アルマゲドン,戦慄の楽譜,アイ、ロボット,海猿
ゼログラビティ,ミニオンズ,マレフィセント,寄生獣
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,ナルニア国物語,美女と野獣,少林サッカー,聲の形,アメリカン・スナイパー,土竜の唄,海猿,デスノート
君の名は,アナと雪の女王,少林サッカー,海猿
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,ミニオンズ,プレデターズ,レッドクリフ,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,ジョーズ,紅の豚,サマーウォーズ,アナと雪の女王,タイタニック,ミニオンズ,美女と野獣,寄生獣,アルマゲドン,図書館戦争,アオハライド,海猿,デスノート
君の名は,風立ちぬ,紅の豚,時をかける少女,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,ミニオンズ,美女と野獣,マレフィセント,ピンポン,キングスマン,猿の惑星,寄生獣,レッドクリフ,アルマゲドン,図書館戦争,アオハライド,本能寺ホテル,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,シンゴジラ,アナと雪の女王,海猿,デスノート
グレイテストショーマン,風の谷のナウシカ,君の名は,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,美女と野獣,少林サッカー,聲の形,言の葉の庭,デスノート
風の谷のナウシカ,ノーゲイム・ノーライフ,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,聲の形,言の葉の庭,寄生獣,レッドクリフ,アメリカン・スナイパー,図書館戦争,本能寺ホテル,土竜の唄
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,シンゴジラ,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,ミニオンズ,美女と野獣,少林サッカー,聲の形,天使にラブソングを,アルマゲドン,フォレストガンプ,図書館戦争,パシフィックリム,アントマン,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,少林サッカー,マレフィセント
風の谷のナウシカ,君の名は,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,ナルニア国物語,少林サッカー,探偵はbarにいる,聲の形,アナコンダ,レッドクリフ,アルマゲドン,図書館戦争,アオハライド,本能寺ホテル,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,ベイマックス,ミニオンズ,美女と野獣,聲の形,猿の惑星,寄生獣
風の谷のナウシカ,君の名は,サマーウォーズ,時をかける少女,ゼログラビティ,ベイマックス,少林サッカー,聲の形,マレフィセント,プレデターズ,寄生獣,デスノート
風の谷のナウシカ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,ナルニア国物語,タイタニック,少林サッカー,マレフィセント,アナコンダ,寄生獣,天使にラブソングを,海猿,デスノート
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,ジョーズ,紅の豚,時をかける少女,アナと雪の女王,タイタニック,ベイマックス,ミニオンズ,美女と野獣,マレフィセント,アナコンダ,寄生獣,アルマゲドン,図書館戦争,戦慄の楽譜,本能寺ホテル,海猿
君の名は,ノーゲイム・ノーライフ,サマーウォーズ,ミニオンズ,聲の形,寄生獣,図書館戦争,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,タイタニック,ベイマックス,プレデターズ,猿の惑星,寄生獣,天使にラブソングを,海猿,デスノート
風の谷のナウシカ,君の名は,サマーウォーズ,時をかける少女,シンゴジラ,少林サッカー,図書館戦争,海猿,デスノート
風の谷のナウシカ,時をかける少女,マレフィセント,海猿
君の名は,ミニオンズ,少林サッカー
紅の豚,アナと雪の女王,ナルニア国物語,美女と野獣,少林サッカー,アナコンダ,猿の惑星,寄生獣,海猿,デスノート
風の谷のナウシカ,君の名は,風立ちぬ,紅の豚,サマーウォーズ,ナルニア国物語,ミニオンズ,少林サッカー
君の名は,サマーウォーズ,天使にラブソングを
聲の形,キングスマン,時計じかけのオレンジ,天使にラブソングを,アルマゲドン,インターステラー,ララランド,シックスセンス,バタフライ・エフェクト,アントマン
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,ゼログラビティ,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,ミニオンズ,美女と野獣,少林サッカー,探偵はbarにいる,聲の形,マレフィセント,アナコンダ,キングスマン,時計じかけのオレンジ,図書館戦争,英国王のスピーチ,プレデターズ,猿の惑星,寄生獣,レッドクリフ,アメリカン・スナイパー,天使にラブソングを,アルマゲドン,インターステラー,ジョニーは戦場へ行った,戦慄の楽譜,アオハライド,ララランド,シックスセンス,バタフライ・エフェクト,アントマン,本能寺ホテル,アイ、ロボット,土竜の唄,海猿,デスノート,インセプション
風の谷のナウシカ,ノーゲイム・ノーライフ,サマーウォーズ,時をかける少女,ナルニア国物語,美女と野獣,デスノート
君の名は,サマーウォーズ,時をかける少女,アナと雪の女王,少林サッカー,デスノート
猿の惑星
グレイテストショーマン,風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,ミニオンズ,美女と野獣,少林サッカー,探偵はbarにいる,聲の形,言の葉の庭,マレフィセント,アナコンダ,ピンポン,キングスマン,羊たちの沈黙,時計じかけのオレンジ,シャイニング,英国王のスピーチ,プレデターズ,猿の惑星,寄生獣,レッドクリフ,アメリカン・スナイパー,天使にラブソングを,アルマゲドン,インターステラー,フルメタル・ジャケット,ジョニーは戦場へ行った,戦慄の楽譜,アオハライド,ララランド,シックスセンス,バタフライ・エフェクト,はじまりのうた,パシフィックリム,セブン,アントマン,本能寺ホテル,アイ、ロボット,土竜の唄,海猿,デスノート,インセプション
君の名は,サマーウォーズ,シンゴジラ,アナと雪の女王,少林サッカー,猿の惑星,図書館戦争,海猿,デスノート
風の谷のナウシカ,君の名は,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,ナルニア国物語,タイタニック,少林サッカー,言の葉の庭,アナコンダ,キングスマン,プレデターズ,猿の惑星,バタフライ・エフェクト,パシフィックリム,アントマン,海猿,デスノート,インセプション
風の谷のナウシカ,君の名は,紅の豚,サマーウォーズ,時をかける少女,ゼログラビティ,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,美女と野獣,少林サッカー,探偵はbarにいる,言の葉の庭,マレフィセント,アナコンダ,プレデターズ,猿の惑星,寄生獣,アメリカン・スナイパー,アルマゲドン,海猿,デスノート
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,サマーウォーズ,時をかける少女,アナと雪の女王,ナルニア国物語,ベイマックス,ミニオンズ,美女と野獣,少林サッカー,聲の形,言の葉の庭,マレフィセント,猿の惑星,寄生獣,図書館戦争,戦慄の楽譜,アオハライド,デスノート
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,ミニオンズ,聲の形,言の葉の庭,ピンポン,猿の惑星,アルマゲドン,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,サマーウォーズ,アナと雪の女王,ナルニア国物語,ベイマックス,ミニオンズ,少林サッカー,聲の形,英国王のスピーチ,インターステラー,図書館戦争,アオハライド,はじまりのうた,デスノート
風の谷のナウシカ,君の名は,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,ナルニア国物語,少林サッカー,探偵はbarにいる,プレデターズ,アメリカン・スナイパー,天使にラブソングを,フォレストガンプ
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,探偵はbarにいる,プレデターズ,猿の惑星,天使にラブソングを,アルマゲドン,本能寺ホテル,海猿,デスノート
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,ナルニア国物語,美女と野獣,少林サッカー,猿の惑星,寄生獣,レッドクリフ,海猿,デスノート
レッドクリフ
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,タイタニック,ミニオンズ,美女と野獣,聲の形,図書館戦争,デスノート
風の谷のナウシカ,君の名は,紅の豚,サマーウォーズ,アナと雪の女王,少林サッカー
ナルニア国物語,レッドクリフ,ララランド
君の名は,ノーゲイム・ノーライフ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,アナと雪の女王,ベイマックス,ミニオンズ,美女と野獣,寄生獣,図書館戦争,戦慄の楽譜,アオハライド,ララランド,本能寺ホテル,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,ジョーズ,サマーウォーズ,時をかける少女,シンゴジラ,ナルニア国物語,ベイマックス,ミニオンズ,美女と野獣,少林サッカー,聲の形,言の葉の庭,マレフィセント
君の名は,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,ゼログラビティ,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,ミニオンズ,探偵はbarにいる,マレフィセント,プレデターズ,猿の惑星,寄生獣,レッドクリフ,天使にラブソングを,アルマゲドン,図書館戦争,アイ、ロボット,海猿,デスノート,インセプション
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,ナルニア国物語,ベイマックス,ミニオンズ,美女と野獣,アナコンダ,猿の惑星,アオハライド,アイ、ロボット,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,風立ちぬ,アナと雪の女王,ナルニア国物語,ミニオンズ,美女と野獣,少林サッカー,アナコンダ,羊たちの沈黙,猿の惑星,寄生獣
風の谷のナウシカ,君の名は,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,ナルニア国物語,プレデターズ
風の谷のナウシカ,君の名は,風立ちぬ,ジョーズ,紅の豚,時をかける少女,アナと雪の女王,タイタニック,少林サッカー,聲の形,本能寺ホテル,土竜の唄,デスノート
ゼログラビティ,ナルニア国物語,タイタニック,ミニオンズ,少林サッカー,プレデターズ,天使にラブソングを,アルマゲドン,図書館戦争,ララランド,アントマン,本能寺ホテル,デスノート
君の名は,風立ちぬ,アナと雪の女王,ベイマックス
風の谷のナウシカ,君の名は,ジョーズ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,ナルニア国物語,タイタニック,ミニオンズ,美女と野獣,少林サッカー,言の葉の庭,プレデターズ,猿の惑星,寄生獣,レッドクリフ,アルマゲドン,フォレストガンプ,図書館戦争,シックスセンス,バタフライ・エフェクト,パシフィックリム,海猿,デスノート
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,サマーウォーズ,時をかける少女,シンゴジラ,アナと雪の女王,ナルニア国物語,タイタニック,ベイマックス,美女と野獣,少林サッカー,聲の形,言の葉の庭,寄生獣,レッドクリフ,天使にラブソングを,図書館戦争,海猿,デスノート
君の名は,サマーウォーズ,時をかける少女,アナと雪の女王,図書館戦争,アオハライド,デスノート
風の谷のナウシカ,風立ちぬ,紅の豚,時をかける少女,アナと雪の女王,タイタニック,ミニオンズ,美女と野獣,マレフィセント,戦慄の楽譜
ジョーズ,シンゴジラ,タイタニック,ミニオンズ,寄生獣,アオハライド,土竜の唄,デスノート
君の名は,風立ちぬ,ベイマックス,少林サッカー,アルマゲドン,海猿
君の名は,アナと雪の女王,ベイマックス,美女と野獣,フォレストガンプ
風の谷のナウシカ,君の名は,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,タイタニック,ミニオンズ,聲の形,言の葉の庭,キングスマン,アメリカン・スナイパー,インターステラー,ララランド,はじまりのうた,デスノート,インセプション
風の谷のナウシカ,君の名は,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,アナと雪の女王,ナルニア国物語,ベイマックス,ミニオンズ,少林サッカー,探偵はbarにいる,寄生獣,土竜の唄,デスノート
風の谷のナウシカ,君の名は,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,シンゴジラ,ナルニア国物語,ミニオンズ,少林サッカー,探偵はbarにいる,猿の惑星,寄生獣,アルマゲドン,図書館戦争,アオハライド,パシフィックリム,セブン,本能寺ホテル,土竜の唄,海猿,デスノート
君の名は,サマーウォーズ,時をかける少女,タイタニック,猿の惑星,アルマゲドン,本能寺ホテル,土竜の唄,海猿,デスノート
風の谷のナウシカ,君の名は,ノーゲイム・ノーライフ,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,タイタニック,少林サッカー,探偵はbarにいる,聲の形,言の葉の庭,羊たちの沈黙,英国王のスピーチ,猿の惑星,アメリカン・スナイパー,ジョニーは戦場へ行った,図書館戦争,アオハライド,パシフィックリム,土竜の唄,海猿
シェイプオブウォーター,美女と野獣
風の谷のナウシカ,ノーゲイム・ノーライフ,サマーウォーズ,時をかける少女,少林サッカー,レッドクリフ,海猿,デスノート
君の名は,ノーゲイム・ノーライフ,風立ちぬ,紅の豚,サマーウォーズ,時をかける少女,アナと雪の女王,ナルニア国物語,ベイマックス,ミニオンズ,聲の形,言の葉の庭,英国王のスピーチ,プレデターズ,図書館戦争,アオハライド,本能寺ホテル,デスノート
君の名は
君の名は,サマーウォーズ,探偵はbarにいる,図書館戦争"

# 人単位の文字列の配列にする

people=data.split(/\n/)

# 人単位の文字列を配列にする

hito=people.map{|person|person.split(/,/)}

# 人単位の配列を０と１のベクトルに変換する

def to_vector(movies,hito)
    movies.map{|movie| 
        if hito.member?(movie)
        then  1
        else  0
    end}
end

# 人単位の配列を０と１のベクトルにする

hito_v=hito.map{|h| to_vector(movies,h)}

# ０／１ベクトルの間の距離を求めるメソッド

def kyori(p1,p2)
    d=0
    [p1,p2].transpose.each{|x|d=d+x[0]^x[1]}
    return d
end

# hito_v[0]さんを自分として設定する

jibun=hito_v[0]

# 自分と他の人の比較

p hito_v.map{|aite| kyori(jibun,aite)}

#-------------- ここまで　ペーストします--------------






■映画を行にした表にすればよい

# 表の行と列を転置する

eiga_v=hito_v.transpose

●その映画を何人が見ているか

p eiga_v[1].sum

●この映画と他の映画との距離

e0=eiga_v[0]
p eiga_v.map{|e| kyori(e0,e)}

●どの映画かわからない？
#全映画の配列のインデックスで映画名がわかる

p movies
p movies[0]
p movies[1]
p movies[2]


●映画の表の構造
# 映画ごとの配列の配列になっています

p eiga_v[0]
p eiga_v[56]

● map.with_indexメソッド

p ["茄子","トマト","人参"].map.with_index{|x,i| [x,i]}

●映画間の距離とインデックスの配列にする

e0=eiga_v[0]
p eiga_v.map.with_index{|e,i| [kyori(e0,e),i]}


● with_indexメソッドを使い、映画名付きでグレイテストショーマンと他の映画との距離を求める
e0=eiga_v[0]
p eiga_v.map.with_index{|eiga,i| [kyori(e0,eiga),movies[i]]}


●本当に似ているのか？
# 排他的論理和の和による距離だけではわからない

# [0,0,0,0,0,0,0,0,0,1] と [1,0,0,0,0,0,0,0,0,0] は本当に近いのか？

# 距離は近いけど
p kyori([0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0])

■tanimoto係数

# A,B,2人の類似度を図る指標のひとつ
# tanimoto係数= AB共通集合の個数/(Aの個数+Bの個数-AB共通集合の個数)

●配列の中の同じオブジェクトの個数

def number(array,obj)
    n=0
    array.each{|x|
      if x==obj then n=n+1
      end
    }
    return n
end

# 1 の個数を調べる
p number([0,1,1,0,0], 1)
p number([[1,1],[1,0],[0,1],[1,1]], [1,1])

 

●tanimoto係数

def tanimoto(a,b)
    na=number(a,1)
    nb=number(b,1)
    nab=number([a,b].transpose, [1,1])
    return nab.to_f/(na+nb-nab)
end

●tanimoto係数を利用した映画の「近さ」

e0=eiga_v[0]
p eiga_v.map.with_index{|e,i|[tanimoto(e0,e),movies[i]]}


●配列を小さい順に並べ替えるsort メソッド

p [5,2,9,7,3].sort

●実験

e0=eiga_v[0]
p eiga_v.map.with_index{|e,i|[tanimoto(e0,e),movies[i]]}.sort

e0=eiga_v[1]
p eiga_v.map.with_index{|e,i|[tanimoto(e0,e),movies[i]]}.sort

e0=eiga_v[26]
p eiga_v.map.with_index{|e,i|[tanimoto(e0,e),movies[i]]}.sort

●メソッドにまとめる

def miteru(movies, eiga_v,j)
    e0=eiga_v[j]
    return eiga_v.map.with_index{|e,i|
            [tanimoto(e0,e),movies[i]]
           }.sort
end

p miteru(movies,eiga_v, 8)


■配列の最後の方の要素の取り出し方

p([2, 3, 5, 7, 9][-3..-1])

●sortした最後の４つだけ取り出す

e0=eiga_v[26]    # "羊たちの沈黙"
p eiga_v.map.with_index{|e,i|[tanimoto(e0,e),movies[i]]}.sort[-4..-1]

■課題

授業で使用した、映画のリストmovies, 映画の視聴ベクトルの表 eiga_v と映画のインデックスを入れると、その映画を見ている人が見ている映画として最もtanimoto係数が大きいものを、その映画以外に4つを提示するメソッド osusume を作成してください

複数のインデックスでosusumeメソッドを実行してください



#実行例
 p osusume(movies,eiga_v,2)
=> [[0.5806451612903226, "時をかける少女"], [0.6140350877192983, "アナと雪の女王"], [0.6229508196721312, "風の谷のナウシカ"], [0.7166666666666667, "サマーウォーズ"], [1.0, "君の名は"]]




